import type { NextPage } from "next";
import Head from "next/head";
import { useState } from "react";
import { Container, Heading, Paragraph, Flex, Input } from "theme-ui";

import { GetStaticProps, GetStaticPropsContext } from "next";

type HomeProps = {
  hashRate: number;
  totalSupply: number;
};

const Home: NextPage<HomeProps> = (props) => {
  const [btc, setBtc] = useState(100);

  const [hashRate, setHashRate] = useState(props.hashRate);
  const fractionOfSupply = btc / props.totalSupply;
  const percentOfSupply = fractionOfSupply * 100;
  return (
    <>
      <Head>
        <title>Green you Bitcoin</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <Heading
        sx={{
          color: "primary",
          fontFamily: "heading",
          fontSize: "40px",
          my: "5rem",
        }}
      >
        Green your Bitcoin
      </Heading>
      <Paragraph sx={{ pb: 20 }}>
        This is a demo, the calculations are not yet accurate
      </Paragraph>
      <Paragraph>Your BTC holdings:</Paragraph>
      <Flex sx={{ alignItems: "center", mb: 20 }}>
        <Input
          sx={{
            width: 200,
          }}
          min={0}
          max={props.totalSupply}
          type="number"
          value={btc}
          onChange={(e) => setBtc(parseFloat(e.currentTarget.value))}
        />
        <Paragraph ml={10}>BTC</Paragraph>
      </Flex>
      <Paragraph>Current global hashrate:</Paragraph>
      <Flex sx={{ alignItems: "center", mb: 20 }}>
        {/* <Input
          sx={{
            width: 200,
            mb: 20,
          }}
          type="number"
          value={hashRate}
          onChange={(e) => setHashRate(parseFloat(e.currentTarget.value))}
        /> */}
        <Paragraph>{props.hashRate.toLocaleString()} TH/s</Paragraph>
      </Flex>
      <Paragraph>You hold</Paragraph>
      <Heading>
        <b>{percentOfSupply}%</b>
      </Heading>
      <Paragraph>
        of total Bitcoin supply ({props.totalSupply.toLocaleString()}). Making
        you responsible for:
      </Paragraph>

      <Heading sx={{ mt: 20 }}>
        {(hashRate * fractionOfSupply).toLocaleString()} TH/s
      </Heading>
      <Paragraph>
        Or {((hashRate * fractionOfSupply) / 110).toFixed(1)} Antminer s19 Pros
        at 110 TH/s
      </Paragraph>
      <Paragraph>
        To ensure your BTC holdings are carbon neutral you can mine this amount
        or more with renewable energy, or purchase an equivalent Green
        Co-investment (GCI) instrument.
      </Paragraph>
      <Paragraph sx={{ fontSize: 1, mt: 30 }}>
        Built by{" "}
        <a
          target={"_blank"}
          rel="noreferrer"
          href="http://twitter.com/islandHODL"
        >
          @islandHODL
        </a>
        <br />
        Inspired by{" "}
        <a
          target={"_blank"}
          rel="noreferrer"
          href="https://twitter.com/thetrocro"
        >
          Troy Cross
        </a>{" "}
        &amp;{" "}
        <a
          target={"_blank"}
          rel="noreferrer"
          href="https://twitter.com/resistancemoney"
        >
          Andrew M. Bailey
        </a>{" "}
        at{" "}
        <a
          target={"_blank"}
          rel="noreferrer"
          href="https://www.resistance.money/green/"
        >
          Resistance.money
        </a>
      </Paragraph>
    </>
  );
};
export const getStaticProps: GetStaticProps<HomeProps> = async () => {
  const getHashRate = await fetch("https://blockchain.info/q/hashrate");
  const hashRate = await getHashRate.json();

  const getTotalSupply = await fetch("https://blockchain.info/q/totalbc");
  const totalSupply = await getTotalSupply.json();

  return {
    props: {
      hashRate: hashRate ? hashRate / 1000 : 0,
      totalSupply: totalSupply ? totalSupply / 100000000 : 21000000,
    },
    revalidate: 20,
  };
};

export default Home;
